"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[195],{6839:(e,t,i)=>{i.d(t,{A:()=>h});var s=i(8119),r=i(6077),a=i(2696),n=i(3675),o=i(1701);class h extends a.A{describe(){return this.deepExtend(super.describe(),{id:"bitfinex",name:"Bitfinex",countries:["VG"],version:"v2",certified:!1,pro:!0,has:{CORS:void 0,spot:!0,margin:!0,swap:!0,future:!1,option:!1,addMargin:!1,borrowCrossMargin:!1,borrowIsolatedMargin:!1,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:!0,createDepositAddress:!0,createLimitOrder:!0,createMarketOrder:!0,createOrder:!0,createPostOnlyOrder:!0,createReduceOnlyOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,createTrailingAmountOrder:!0,createTrailingPercentOrder:!1,createTriggerOrder:!0,editOrder:!0,fetchBalance:!0,fetchBorrowInterest:!1,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrder:!0,fetchClosedOrders:!0,fetchCrossBorrowRate:!1,fetchCrossBorrowRates:!1,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDepositAddressesByNetwork:!1,fetchDepositsWithdrawals:!0,fetchFundingHistory:!1,fetchFundingRate:"emulated",fetchFundingRateHistory:!0,fetchFundingRates:!0,fetchIndexOHLCV:!1,fetchIsolatedBorrowRate:!1,fetchIsolatedBorrowRates:!1,fetchLedger:!0,fetchLeverage:!1,fetchLeverageTiers:!1,fetchLiquidations:!0,fetchMarginMode:!1,fetchMarketLeverageTiers:!1,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterest:!0,fetchOpenInterestHistory:!0,fetchOpenInterests:!0,fetchOpenOrder:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderBooks:!1,fetchOrderTrades:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!0,fetchPremiumIndexOHLCV:!1,fetchStatus:!0,fetchTickers:!0,fetchTime:!1,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactionFees:void 0,fetchTransactions:"emulated",reduceMargin:!1,repayCrossMargin:!1,repayIsolatedMargin:!1,setLeverage:!1,setMargin:!0,setMarginMode:!1,setPositionMode:!1,signIn:!1,transfer:!0,withdraw:!0},timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","3h":"3h","4h":"4h","6h":"6h","12h":"12h","1d":"1D","1w":"7D","2w":"14D","1M":"1M"},rateLimit:250,urls:{logo:"https://github.com/user-attachments/assets/4a8e947f-ab46-481a-a8ae-8b20e9b03178",api:{v1:"https://api.bitfinex.com",public:"https://api-pub.bitfinex.com",private:"https://api.bitfinex.com"},www:"https://www.bitfinex.com",doc:["https://docs.bitfinex.com/v2/docs/","https://github.com/bitfinexcom/bitfinex-api-node"],fees:"https://www.bitfinex.com/fees"},api:{public:{get:{"conf/{config}":2.7,"conf/pub:{action}:{object}":2.7,"conf/pub:{action}:{object}:{detail}":2.7,"conf/pub:map:{object}":2.7,"conf/pub:map:{object}:{detail}":2.7,"conf/pub:map:currency:{detail}":2.7,"conf/pub:map:currency:sym":2.7,"conf/pub:map:currency:label":2.7,"conf/pub:map:currency:unit":2.7,"conf/pub:map:currency:undl":2.7,"conf/pub:map:currency:pool":2.7,"conf/pub:map:currency:explorer":2.7,"conf/pub:map:currency:tx:fee":2.7,"conf/pub:map:tx:method":2.7,"conf/pub:list:{object}":2.7,"conf/pub:list:{object}:{detail}":2.7,"conf/pub:list:currency":2.7,"conf/pub:list:pair:exchange":2.7,"conf/pub:list:pair:margin":2.7,"conf/pub:list:pair:futures":2.7,"conf/pub:list:competitions":2.7,"conf/pub:info:{object}":2.7,"conf/pub:info:{object}:{detail}":2.7,"conf/pub:info:pair":2.7,"conf/pub:info:pair:futures":2.7,"conf/pub:info:tx:status":2.7,"conf/pub:fees":2.7,"platform/status":8,tickers:2.7,"ticker/{symbol}":2.7,"tickers/hist":2.7,"trades/{symbol}/hist":2.7,"book/{symbol}/{precision}":1,"book/{symbol}/P0":1,"book/{symbol}/P1":1,"book/{symbol}/P2":1,"book/{symbol}/P3":1,"book/{symbol}/R0":1,"stats1/{key}:{size}:{symbol}:{side}/{section}":2.7,"stats1/{key}:{size}:{symbol}:{side}/last":2.7,"stats1/{key}:{size}:{symbol}:{side}/hist":2.7,"stats1/{key}:{size}:{symbol}/{section}":2.7,"stats1/{key}:{size}:{symbol}/last":2.7,"stats1/{key}:{size}:{symbol}/hist":2.7,"stats1/{key}:{size}:{symbol}:long/last":2.7,"stats1/{key}:{size}:{symbol}:long/hist":2.7,"stats1/{key}:{size}:{symbol}:short/last":2.7,"stats1/{key}:{size}:{symbol}:short/hist":2.7,"candles/trade:{timeframe}:{symbol}:{period}/{section}":2.7,"candles/trade:{timeframe}:{symbol}/{section}":2.7,"candles/trade:{timeframe}:{symbol}/last":2.7,"candles/trade:{timeframe}:{symbol}/hist":2.7,"status/{type}":2.7,"status/deriv":2.7,"status/deriv/{symbol}/hist":2.7,"liquidations/hist":80,"rankings/{key}:{timeframe}:{symbol}/{section}":2.7,"rankings/{key}:{timeframe}:{symbol}/hist":2.7,"pulse/hist":2.7,"pulse/profile/{nickname}":2.7,"funding/stats/{symbol}/hist":10,"ext/vasps":1},post:{"calc/trade/avg":2.7,"calc/fx":2.7}},private:{post:{"auth/r/wallets":2.7,"auth/r/wallets/hist":2.7,"auth/r/orders":2.7,"auth/r/orders/{symbol}":2.7,"auth/w/order/submit":2.7,"auth/w/order/update":2.7,"auth/w/order/cancel":2.7,"auth/w/order/multi":2.7,"auth/w/order/cancel/multi":2.7,"auth/r/orders/{symbol}/hist":2.7,"auth/r/orders/hist":2.7,"auth/r/order/{symbol}:{id}/trades":2.7,"auth/r/trades/{symbol}/hist":2.7,"auth/r/trades/hist":2.7,"auth/r/ledgers/{currency}/hist":2.7,"auth/r/ledgers/hist":2.7,"auth/r/info/margin/{key}":2.7,"auth/r/info/margin/base":2.7,"auth/r/info/margin/sym_all":2.7,"auth/r/positions":2.7,"auth/w/position/claim":2.7,"auth/w/position/increase:":2.7,"auth/r/position/increase/info":2.7,"auth/r/positions/hist":2.7,"auth/r/positions/audit":2.7,"auth/r/positions/snap":2.7,"auth/w/deriv/collateral/set":2.7,"auth/w/deriv/collateral/limits":2.7,"auth/r/funding/offers":2.7,"auth/r/funding/offers/{symbol}":2.7,"auth/w/funding/offer/submit":2.7,"auth/w/funding/offer/cancel":2.7,"auth/w/funding/offer/cancel/all":2.7,"auth/w/funding/close":2.7,"auth/w/funding/auto":2.7,"auth/w/funding/keep":2.7,"auth/r/funding/offers/{symbol}/hist":2.7,"auth/r/funding/offers/hist":2.7,"auth/r/funding/loans":2.7,"auth/r/funding/loans/hist":2.7,"auth/r/funding/loans/{symbol}":2.7,"auth/r/funding/loans/{symbol}/hist":2.7,"auth/r/funding/credits":2.7,"auth/r/funding/credits/hist":2.7,"auth/r/funding/credits/{symbol}":2.7,"auth/r/funding/credits/{symbol}/hist":2.7,"auth/r/funding/trades/{symbol}/hist":2.7,"auth/r/funding/trades/hist":2.7,"auth/r/info/funding/{key}":2.7,"auth/r/info/user":2.7,"auth/r/summary":2.7,"auth/r/logins/hist":2.7,"auth/r/permissions":2.7,"auth/w/token":2.7,"auth/r/audit/hist":2.7,"auth/w/transfer":2.7,"auth/w/deposit/address":24,"auth/w/deposit/invoice":24,"auth/w/withdraw":24,"auth/r/movements/{currency}/hist":2.7,"auth/r/movements/hist":2.7,"auth/r/alerts":5.34,"auth/w/alert/set":2.7,"auth/w/alert/price:{symbol}:{price}/del":2.7,"auth/w/alert/{type}:{symbol}:{price}/del":2.7,"auth/calc/order/avail":2.7,"auth/w/settings/set":2.7,"auth/r/settings":2.7,"auth/w/settings/del":2.7,"auth/r/pulse/hist":2.7,"auth/w/pulse/add":16,"auth/w/pulse/del":2.7}}},fees:{trading:{feeSide:"get",percentage:!0,tierBased:!0,maker:this.parseNumber("0.001"),taker:this.parseNumber("0.002"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.002")],[this.parseNumber("500000"),this.parseNumber("0.002")],[this.parseNumber("1000000"),this.parseNumber("0.002")],[this.parseNumber("2500000"),this.parseNumber("0.002")],[this.parseNumber("5000000"),this.parseNumber("0.002")],[this.parseNumber("7500000"),this.parseNumber("0.002")],[this.parseNumber("10000000"),this.parseNumber("0.0018")],[this.parseNumber("15000000"),this.parseNumber("0.0016")],[this.parseNumber("20000000"),this.parseNumber("0.0014")],[this.parseNumber("25000000"),this.parseNumber("0.0012")],[this.parseNumber("30000000"),this.parseNumber("0.001")]],maker:[[this.parseNumber("0"),this.parseNumber("0.001")],[this.parseNumber("500000"),this.parseNumber("0.0008")],[this.parseNumber("1000000"),this.parseNumber("0.0006")],[this.parseNumber("2500000"),this.parseNumber("0.0004")],[this.parseNumber("5000000"),this.parseNumber("0.0002")],[this.parseNumber("7500000"),this.parseNumber("0")],[this.parseNumber("10000000"),this.parseNumber("0")],[this.parseNumber("15000000"),this.parseNumber("0")],[this.parseNumber("20000000"),this.parseNumber("0")],[this.parseNumber("25000000"),this.parseNumber("0")],[this.parseNumber("30000000"),this.parseNumber("0")]]}},funding:{withdraw:{}}},precisionMode:n.v,options:{precision:"R0",exchangeTypes:{MARKET:"market","EXCHANGE MARKET":"market",LIMIT:"limit","EXCHANGE LIMIT":"limit","EXCHANGE STOP":"market","EXCHANGE FOK":"limit","EXCHANGE STOP LIMIT":"limit","EXCHANGE IOC":"limit"},orderTypes:{market:"EXCHANGE MARKET",limit:"EXCHANGE LIMIT"},fiat:{USD:"USD",EUR:"EUR",JPY:"JPY",GBP:"GBP",CHN:"CHN"},v2AccountsByType:{spot:"exchange",exchange:"exchange",funding:"funding",margin:"margin",derivatives:"margin",future:"margin",swap:"margin"},withdraw:{includeFee:!1},networks:{BTC:"BITCOIN",LTC:"LITECOIN",ERC20:"ETHEREUM",OMNI:"TETHERUSO",LIQUID:"TETHERUSL",TRC20:"TETHERUSX",EOS:"TETHERUSS",AVAX:"TETHERUSDTAVAX",SOL:"TETHERUSDTSOL",ALGO:"TETHERUSDTALG",BCH:"TETHERUSDTBCH",KSM:"TETHERUSDTKSM",DVF:"TETHERUSDTDVF",OMG:"TETHERUSDTOMG"},networksById:{TETHERUSE:"ERC20"}},features:{default:{sandbox:!1,createOrder:{marginMode:!0,triggerPrice:!0,triggerPriceType:void 0,triggerDirection:!1,stopLossPrice:!0,takeProfitPrice:!0,attachedStopLossTakeProfit:void 0,timeInForce:{IOC:!0,FOK:!0,PO:!0,GTD:!1},hedged:!1,trailing:!0,leverage:!0,marketBuyRequiresPrice:!1,marketBuyByCost:!0,selfTradePrevention:!1,iceberg:!1},createOrders:{max:75},fetchMyTrades:{marginMode:!1,limit:2500,daysBack:void 0,untilDays:1e5},fetchOrder:{marginMode:!1,trigger:!1,trailing:!1},fetchOpenOrders:{marginMode:!1,limit:void 0,trigger:!1,trailing:!1},fetchOrders:void 0,fetchClosedOrders:{marginMode:!1,limit:void 0,daysBack:void 0,daysBackCanceled:void 0,untilDays:1e5,trigger:!1,trailing:!1},fetchOHLCV:{limit:1e4}},spot:{extends:"default"},swap:{linear:{extends:"default"},inverse:void 0},future:{linear:void 0,inverse:void 0}},exceptions:{exact:{11010:s.RateLimitExceeded,10001:s.PermissionDenied,10020:s.BadRequest,10100:s.AuthenticationError,10114:s.InvalidNonce,20060:s.OnMaintenance,temporarily_unavailable:s.ExchangeNotAvailable},broad:{"available balance is only":s.InsufficientFunds,"not enough exchange balance":s.InsufficientFunds,"Order not found":s.OrderNotFound,"symbol: invalid":s.BadSymbol}},commonCurrencies:{UST:"USDT",EUTF0:"EURT",USTF0:"USDT",ALG:"ALGO",AMP:"AMPL",ATO:"ATOM",BCHABC:"XEC",BCHN:"BCH",DAT:"DATA",DOG:"MDOGE",DSH:"DASH",EDO:"PNT",EUS:"EURS",EUT:"EURT",HTX:"HT",IDX:"ID",IOT:"IOTA",IQX:"IQ",LUNA:"LUNC",LUNA2:"LUNA",MNA:"MANA",ORS:"ORS Group",PAS:"PASS",QSH:"QASH",QTM:"QTUM",RBT:"RBTC",SNG:"SNGLS",STJ:"STORJ",TERRAUST:"USTC",TSD:"TUSD",YGG:"YEED",YYW:"YOYOW",UDC:"USDC",VSY:"VSYS",WAX:"WAXP",XCH:"XCHF",ZBT:"ZB"}})}isFiat(e){return e in this.options.fiat}getCurrencyId(e){return"f"+e}getCurrencyName(e){if(e in this.options.currencyNames)return this.options.currencyNames[e];throw new s.NotSupported(this.id+" "+e+" not supported for withdrawal")}amountToPrecision(e,t){return e=this.safeSymbol(e),this.decimalToPrecision(t,n.R3,this.markets[e].precision.amount,n.fv)}priceToPrecision(e,t){return e=this.safeSymbol(e),t=this.decimalToPrecision(t,n.D_,this.markets[e].precision.price,this.precisionMode),this.decimalToPrecision(t,n.R3,8,n.fv)}async fetchStatus(e={}){let t=await this.publicGetPlatformStatus(e),i=this.safeString(t,0);return{status:this.safeString({0:"maintenance",1:"ok"},i,i),updated:void 0,eta:void 0,url:void 0,info:t}}async fetchMarkets(e={}){let t=this.publicGetConfPubInfoPair(e),i=this.publicGetConfPubInfoPairFutures(e),s=this.publicGetConfPubListPairMargin(e),[r,a,n]=await Promise.all([t,i,s]);r=this.safeList(r,0,[]),a=this.safeList(a,0,[]);let o=this.arrayConcat(r,a);n=this.safeValue(n,0,[]);let h=[];for(let e=0;e<o.length;e++){let t,i,s,r;let a=o[e],d=this.safeStringUpper(a,0),l=this.safeValue(a,1,{}),u=!0;d.indexOf("F0")>=0&&(u=!1);let c=!u;if(d.indexOf(":")>=0){let e=d.split(":");t=e[0],i=e[1]}else t=d.slice(0,3),i=d.slice(3,6);let f=this.safeCurrencyCode(t),m=this.safeCurrencyCode(i),p=f.split("F0"),g=m.split("F0"),b=(f=this.safeString(p,0))+"/"+(m=this.safeString(g,0));t=this.getCurrencyId(t),i=this.getCurrencyId(i),c&&(s=m,r=m,b=b+":"+s);let y=this.safeString(l,3),v=this.safeString(l,4),w=!1;u&&this.inArray(d,n)&&(w=!0),h.push({id:"t"+d,symbol:b,base:f,quote:m,settle:s,baseId:t,quoteId:i,settleId:r,type:u?"spot":"swap",spot:u,margin:w,swap:c,future:!1,option:!1,active:!0,contract:c,linear:!!c||void 0,inverse:!c&&void 0,contractSize:c?this.parseNumber("1"):void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:parseInt("8"),price:parseInt("5")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.parseNumber(y),max:this.parseNumber(v)},price:{min:this.parseNumber("1e-8"),max:void 0},cost:{min:void 0,max:void 0}},created:void 0,info:l})}return h}async fetchCurrencies(e={}){let t=await this.publicGetConfConfig(this.extend({config:"pub:list:currency,pub:map:currency:sym,pub:map:currency:label,pub:map:currency:unit,pub:map:currency:undl,pub:map:currency:pool,pub:map:currency:explorer,pub:map:currency:tx:fee,pub:map:tx:method"},e)),i={sym:this.indexBy(this.safeValue(t,1,[]),0),label:this.indexBy(this.safeValue(t,2,[]),0),unit:this.indexBy(this.safeValue(t,3,[]),0),undl:this.indexBy(this.safeValue(t,4,[]),0),pool:this.indexBy(this.safeValue(t,5,[]),0),explorer:this.indexBy(this.safeValue(t,6,[]),0),fees:this.indexBy(this.safeValue(t,7,[]),0)},s=this.safeValue(t,0,[]),r={};for(let e=0;e<s.length;e++){let a;let n=s[e];if(n.indexOf("F0")>=0)continue;let o=this.safeCurrencyCode(n),h=this.safeValue(i.label,n,[]),d=this.safeString(h,1),l=this.safeValue(i.pool,n,[]);(void 0!==this.safeString(l,1)||n in i.explorer)&&(a="crypto");let u=this.safeValue(i.fees,n,[]),c=this.safeValue(u,1,[]),f=this.safeNumber(c,1),m=this.safeValue(i.undl,n,[]),p="f"+n;r[o]={id:p,uppercaseId:n,code:o,info:[n,h,l,u,m],type:a,name:d,active:!0,deposit:void 0,withdraw:void 0,fee:f,precision:parseInt("8"),limits:{amount:{min:this.parseNumber(this.parsePrecision("8")),max:void 0},withdraw:{min:f,max:void 0}},networks:{}};let g={},b=this.safeValue(t,8,[]),y=n.replace("F0","");for(let e=0;e<b.length;e++){let t=b[e],i=this.safeString(t,0);this.safeString(this.safeValue(t,1,[]),0)===y&&(g[this.networkIdToCode(i)]={info:i,id:i.toLowerCase(),network:i,active:void 0,deposit:void 0,withdraw:void 0,fee:void 0,precision:void 0,limits:{withdraw:{min:void 0,max:void 0}}})}Object.keys(g).length>0&&(r[o].networks=g)}return r}async fetchBalance(e={}){await this.loadMarkets();let t=this.safeValue(this.options,"v2AccountsByType",{}),i=this.safeString(e,"type","exchange"),r=this.safeString(t,i,i);if(void 0===r){let e=Object.keys(t);throw new s.ExchangeError(this.id+" fetchBalance() type parameter must be one of "+e.join(", "))}let a="derivatives"===i,n=this.omit(e,"type"),o=await this.privatePostAuthRWallets(n),h={info:o};for(let e=0;e<o.length;e++){let t=o[e],i=this.account(),s=this.safeString(t,3);"0"!==s&&(i.debt=s);let n=this.safeString(t,0),d=this.safeStringLower(t,1,""),l=d.length-2,u="f0"===d.slice(l),c=!a||u;if(r===n&&c){let e=this.safeCurrencyCode(d);i.total=this.safeString(t,2),i.free=this.safeString(t,4),h[e]=i}}return this.safeBalance(h)}async transfer(e,t,i,r,a={}){await this.loadMarkets();let n=this.safeValue(this.options,"v2AccountsByType",{}),o=this.safeString(n,i);if(void 0===o){let e=Object.keys(n);throw new s.ArgumentsRequired(this.id+" transfer() fromAccount must be one of "+e.join(", "))}let h=this.safeString(n,r);if(void 0===h){let e=Object.keys(n);throw new s.ArgumentsRequired(this.id+" transfer() toAccount must be one of "+e.join(", "))}let d=this.currency(e),l=this.convertDerivativesId(d,i),u=this.convertDerivativesId(d,r),c=this.currencyToPrecision(e,t),f=await this.privatePostAuthWTransfer(this.extend({amount:c,currency:l,currency_to:u,from:o,to:h},a));if("error"===this.safeString(f,0)){let e=this.safeString(f,2,"");throw this.throwExactlyMatchedException(this.exceptions.exact,e,this.id+" "+e),new s.ExchangeError(this.id+" "+e)}return this.parseTransfer({result:f},d)}parseTransfer(e,t){let i=this.safeList(e,"result"),s=this.safeInteger(i,0),r=this.safeValue(i,4),a=this.safeString(r,1),n=this.safeString(r,2),o=this.safeString(r,5),h=this.safeString(i,6);return{id:void 0,timestamp:s,datetime:this.iso8601(s),status:this.parseTransferStatus(h),amount:this.safeNumber(r,7),currency:this.safeCurrencyCode(o,t),fromAccount:a,toAccount:n,info:i}}parseTransferStatus(e){return this.safeString({SUCCESS:"ok",ERROR:"failed",FAILURE:"failed"},e,e)}convertDerivativesId(e,t){let i;let s=this.safeValue(e,"info"),r=this.safeString(s,0),a=this.safeValue(s,4,[]);if("derivatives"===t){let e=(i=this.safeString(a,0,r)).length-2;"F0"!==i.slice(e)&&(i+="F0")}else i="margin"!==t?this.safeString(a,1,r):r;return i}async fetchOrderBook(e,t,i={}){await this.loadMarkets();let s=this.safeValue(this.options,"precision","R0"),a=this.market(e),n={symbol:a.id,precision:s};void 0!==t&&(n.len=t);let o=this.extend(n,i),h=await this.publicGetBookSymbolPrecision(o),d=this.milliseconds(),l={symbol:a.symbol,bids:[],asks:[],timestamp:d,datetime:this.iso8601(d),nonce:void 0},u="R0"===o.precision?1:0;for(let e=0;e<h.length;e++){let t=h[e],i=this.safeNumber(t,u),s=this.safeString(t,2),a=r.Y.stringAbs(s);l[r.Y.stringGt(s,"0")?"bids":"asks"].push([i,this.parseNumber(a)])}return l.bids=this.sortBy(l.bids,0,!0),l.asks=this.sortBy(l.asks,0),l}parseTicker(e,t){let i=this.safeList(e,"result"),s=this.safeSymbol(void 0,t),a=i.length,n=this.safeString(i,a-4),o=this.safeString(i,a-5);return this.safeTicker({symbol:s,timestamp:void 0,datetime:void 0,high:this.safeString(i,a-2),low:this.safeString(i,a-1),bid:this.safeString(i,a-10),bidVolume:this.safeString(i,a-9),ask:this.safeString(i,a-8),askVolume:this.safeString(i,a-7),vwap:void 0,open:void 0,close:n,last:n,previousClose:void 0,change:this.safeString(i,a-6),percentage:r.Y.stringMul(o,"100"),average:void 0,baseVolume:this.safeString(i,a-3),quoteVolume:void 0,info:i},t)}async fetchTickers(e,t={}){await this.loadMarkets();let i={};if(void 0!==(e=this.marketSymbols(e))){let t=this.marketIds(e);i.symbols=t.join(",")}else i.symbols="ALL";let s=await this.publicGetTickers(this.extend(i,t)),r={};for(let e=0;e<s.length;e++){let t=s[e],i=this.safeString(t,0),a=this.safeMarket(i);r[a.symbol]=this.parseTicker({result:t},a)}return this.filterByArrayTickers(r,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();let i=this.market(e),s={symbol:i.id},r=await this.publicGetTickerSymbol(this.extend(s,t));return this.parseTicker({result:r},i)}parseTrade(e,t){let i,s,a,n,o;let h=this.safeList(e,"result",[]),d=h.length>5,l=this.safeString(h,0),u=this.safeString(h,d?4:2),c=this.safeString(h,d?5:3);"-"===u[0]?(i="sell",u=r.Y.stringAbs(u)):i="buy";let f=this.safeSymbol(void 0,t),m=this.safeInteger(h,d?2:1);if(d){let e=h[1];f=this.safeSymbol(e),s=this.safeString(h,3),a=1===this.safeInteger(h,8)?"maker":"taker";let t=this.safeString(h,9);t=r.Y.stringNeg(t);let i=this.safeString(h,10);o={cost:t,currency:this.safeCurrencyCode(i)};let d=h[6];n=this.safeString(this.options.exchangeTypes,d)}return this.safeTrade({id:l,timestamp:m,datetime:this.iso8601(m),symbol:f,order:s,side:i,type:n,takerOrMaker:a,price:c,amount:u,cost:void 0,fee:o,info:h},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();let r=!1;if([r,s]=this.handleOptionAndParams(s,"fetchTrades","paginate"),r)return await this.fetchPaginatedCallDynamic("fetchTrades",e,t,i,s,1e4);let a=this.market(e),n="-1",o={symbol:a.id};void 0!==t&&(o.start=t,n="1"),void 0!==i&&(o.limit=Math.min(i,1e4)),o.sort=n,[o,s]=this.handleUntilOption("end",o,s);let h=await this.publicGetTradesSymbolHist(this.extend(o,s)),d=this.sortBy(h,1),l=[];for(let e=0;e<d.length;e++)l.push({result:d[e]});return this.parseTrades(l,a,void 0,i)}async fetchOHLCV(e,t="1m",i,s=100,r={}){await this.loadMarkets();let a=!1;if([a,r]=this.handleOptionAndParams(r,"fetchOHLCV","paginate"),a)return await this.fetchPaginatedCallDeterministic("fetchOHLCV",e,i,s,t,r,1e4);let n=this.market(e);s=void 0===s?1e4:Math.min(s,1e4);let o={symbol:n.id,timeframe:this.safeString(this.timeframes,t,t),sort:1,limit:s};void 0!==i&&(o.start=i),[o,r]=this.handleUntilOption("end",o,r);let h=await this.publicGetCandlesTradeTimeframeSymbolHist(this.extend(o,r));return this.parseOHLCVs(h,n,t,i,s)}parseOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,2),this.safeNumber(e,5)]}parseOrderStatus(e){if(void 0===e)return e;let t=e.split(" "),i=this.safeString(t,0);return this.safeString({ACTIVE:"open",PARTIALLY:"open",EXECUTED:"closed",CANCELED:"canceled",INSUFFICIENT:"canceled","POSTONLY CANCELED":"canceled",RSN_DUST:"rejected",RSN_PAUSE:"rejected","IOC CANCELED":"canceled","FILLORKILL CANCELED":"canceled"},i,e)}parseOrderFlags(e){return this.safeValue({1024:["reduceOnly"],4096:["postOnly"],5120:["reduceOnly","postOnly"]},e,void 0)}parseTimeInForce(e){return this.safeString({"EXCHANGE IOC":"IOC","EXCHANGE FOK":"FOK",IOC:"IOC",FOK:"FOK"},e,"GTC")}parseOrder(e,t){let i,s;let a=this.safeList(e,"result"),n=this.safeString(a,0),o=this.safeString(a,3),h=this.safeSymbol(o),d=this.safeInteger(a,5),l=r.Y.stringAbs(this.safeString(a,6)),u=this.safeString(a,7),c=r.Y.stringAbs(u),f=r.Y.stringLt(u,"0")?"sell":"buy",m=this.safeString(a,8),p=this.safeString(this.safeValue(this.options,"exchangeTypes"),m),g=this.parseTimeInForce(m),b=this.safeString(a,12),y=this.parseOrderFlags(b),v=!1;if(void 0!==y)for(let e=0;e<y.length;e++)"postOnly"===y[e]&&(v=!0);let w=this.safeString(a,16);("EXCHANGE STOP"===m||"EXCHANGE STOP LIMIT"===m)&&(w=void 0,i=this.safeString(a,16),"EXCHANGE STOP LIMIT"===m&&(w=this.safeString(a,19)));let S=this.safeString(a,13);if(void 0!==S){let e=S.split(" @ ");s=this.parseOrderStatus(this.safeString(e,0))}let O=this.safeString(a,17),T=this.safeString(a,2);return this.safeOrder({info:a,id:n,clientOrderId:T,timestamp:d,datetime:this.iso8601(d),lastTradeTimestamp:void 0,symbol:h,type:p,timeInForce:g,postOnly:v,side:f,price:w,triggerPrice:i,amount:c,cost:void 0,average:O,filled:void 0,remaining:l,status:s,fee:void 0,trades:void 0},t)}createOrderRequest(e,t,i,a,n,o={}){let h;let d=this.market(e),l=this.amountToPrecision(e,a);l="buy"===i?l:r.Y.stringNeg(l);let u={symbol:d.id,amount:l},c=this.safeString2(o,"stopPrice","triggerPrice"),f=this.safeString(o,"trailingAmount"),m=this.safeString(o,"timeInForce"),p=this.safeBool(o,"postOnly",!1),g=this.safeBool(o,"reduceOnly",!1),b=this.safeValue2(o,"cid","clientOrderId"),y=t.toUpperCase();void 0!==f?(y="TRAILING STOP",u.price_trailing=f):void 0!==c&&(u.price=this.priceToPrecision(e,c),"limit"===t?(y="STOP LIMIT",u.price_aux_limit=this.priceToPrecision(e,n)):y="STOP");let v="IOC"===m,w="FOK"===m;if((v||w)&&void 0===n)throw new s.InvalidOrder(this.id+" createOrder() requires a price argument with IOC and FOK orders");if((v||w)&&"market"===t)throw new s.InvalidOrder(this.id+" createOrder() does not allow market IOC and FOK orders");"market"!==t&&void 0===c&&(u.price=this.priceToPrecision(e,n)),v?y="IOC":w&&(y="FOK"),[h,o]=this.handleMarginModeAndParams("createOrder",o),d.spot&&void 0===h&&(y="EXCHANGE "+y),u.type=y;let S=0;return(p||"PO"===m)&&(S=this.sum(S,4096)),g&&(S=this.sum(S,1024)),0!==S&&(u.flags=S),void 0!==b&&(u.cid=b),o=this.omit(o,["triggerPrice","stopPrice","timeInForce","postOnly","reduceOnly","trailingAmount","clientOrderId"]),this.extend(u,o)}async createOrder(e,t,i,r,a,n={}){await this.loadMarkets();let o=this.market(e),h=this.createOrderRequest(e,t,i,r,a,n),d=await this.privatePostAuthWOrderSubmit(h);if("SUCCESS"!==this.safeString(d,6)){let e=d[5],t=d[7];throw new s.ExchangeError(this.id+" "+d[6]+": "+t+" (#"+e+")")}let l=this.safeList(d,4,[]),u=this.safeList(l,0);return this.parseOrder({result:u},o)}async createOrders(e,t={}){await this.loadMarkets();let i=[];for(let t=0;t<e.length;t++){let s=e[t],r=this.safeString(s,"symbol"),a=this.safeString(s,"type"),n=this.safeString(s,"side"),o=this.safeNumber(s,"amount"),h=this.safeNumber(s,"price"),d=this.safeDict(s,"params",{}),l=this.createOrderRequest(r,a,n,o,h,d);i.push(["on",l])}let s=await this.privatePostAuthWOrderMulti({ops:i}),r=[],a=this.safeList(s,4,[]);for(let e=0;e<a.length;e++){let t=a[e][4];r.push({result:t[0]})}return this.parseOrders(r)}async cancelAllOrders(e,t={}){await this.loadMarkets();let i=await this.privatePostAuthWOrderCancelMulti(this.extend({all:1},t)),s=this.safeList(i,4,[]),r=[];for(let e=0;e<s.length;e++)r.push({result:s[e]});return this.parseOrders(r)}async cancelOrder(e,t,i={}){let r,a;await this.loadMarkets();let n=this.safeValue2(i,"cid","clientOrderId");if(void 0!==t&&(a=this.market(t)),void 0!==n){let e=this.safeValue(i,"cidDate");if(void 0===e)throw new s.InvalidOrder(this.id+" canceling an order by clientOrderId ('cid') requires both 'cid' and 'cid_date' ('YYYY-MM-DD')");r={cid:n,cid_date:e},i=this.omit(i,["cid","clientOrderId"])}else r={id:parseInt(e)};let o=await this.privatePostAuthWOrderCancel(this.extend(r,i)),h=this.safeValue(o,4);return this.parseOrder({result:h},a)}async cancelOrders(e,t,i={}){let s;await this.loadMarkets();for(let t=0;t<e.length;t++)e[t]=this.parseToNumeric(e[t]);void 0!==t&&(s=this.market(t));let r=await this.privatePostAuthWOrderCancelMulti(this.extend({id:e},i)),a=this.safeList(r,4,[]),n=[];for(let e=0;e<a.length;e++)n.push({result:a[e]});return this.parseOrders(n,s)}async fetchOpenOrder(e,t,i={}){let r={id:[parseInt(e)]},a=await this.fetchOpenOrders(t,void 0,void 0,this.extend(r,i)),n=this.safeValue(a,0);if(void 0===n)throw new s.OrderNotFound(this.id+" order "+e+" not found");return n}async fetchClosedOrder(e,t,i={}){let r={id:[parseInt(e)]},a=await this.fetchClosedOrders(t,void 0,void 0,this.extend(r,i)),n=this.safeValue(a,0);if(void 0===n)throw new s.OrderNotFound(this.id+" order "+e+" not found");return n}async fetchOpenOrders(e,t,i,s={}){let r,a;await this.loadMarkets();let n={};void 0===e?a=await this.privatePostAuthROrders(this.extend(n,s)):(r=this.market(e),n.symbol=r.id,a=await this.privatePostAuthROrdersSymbol(this.extend(n,s)));let o=[];for(let e=0;e<a.length;e++)o.push({result:a[e]});return this.parseOrders(o,r,t,i)}async fetchClosedOrders(e,t,i,s={}){let r,a;await this.loadMarkets();let n=!1;if([n,s]=this.handleOptionAndParams(s,"fetchClosedOrders","paginate"),n)return await this.fetchPaginatedCallDynamic("fetchClosedOrders",e,t,i,s);let o={};void 0!==t&&(o.start=t),void 0!==i&&(o.limit=i),[o,s]=this.handleUntilOption("end",o,s),void 0===e?a=await this.privatePostAuthROrdersHist(this.extend(o,s)):(r=this.market(e),o.symbol=r.id,a=await this.privatePostAuthROrdersSymbolHist(this.extend(o,s)));let h=[];for(let e=0;e<a.length;e++)h.push({result:a[e]});return this.parseOrders(h,r,t,i)}async fetchOrderTrades(e,t,i,r,a={}){if(void 0===t)throw new s.ArgumentsRequired(this.id+" fetchOrderTrades() requires a symbol argument");await this.loadMarkets();let n=this.market(t),o={id:parseInt(e),symbol:n.id},h=await this.privatePostAuthROrderSymbolIdTrades(this.extend(o,a)),d=[];for(let e=0;e<h.length;e++)d.push({result:h[e]});return this.parseTrades(d,n,i,r)}async fetchMyTrades(e,t,i,s={}){let r,a;await this.loadMarkets();let n={end:this.milliseconds()};void 0!==t&&(n.start=t),void 0!==i&&(n.limit=i),void 0!==e?(r=this.market(e),n.symbol=r.id,a=await this.privatePostAuthRTradesSymbolHist(this.extend(n,s))):a=await this.privatePostAuthRTradesHist(this.extend(n,s));let o=[];for(let e=0;e<a.length;e++)o.push({result:a[e]});return this.parseTrades(o,r,t,i)}async createDepositAddress(e,t={}){return await this.loadMarkets(),await this.fetchDepositAddress(e,this.extend({op_renew:1},t))}async fetchDepositAddress(e,t={}){await this.loadMarkets();let i=this.currency(e),r=this.safeString(t,"network",e),a=this.safeValue(i,"networks",{}),n=this.safeValue(a,r),o=this.safeString(n,"id");if(void 0===o)throw new s.ArgumentsRequired(this.id+" fetchDepositAddress() could not find a network for '"+e+"'. You can specify it by providing the 'network' value inside params");let h=this.safeString(t,"wallet","exchange");t=this.omit(t,"network","wallet");let d=await this.privatePostAuthWDepositAddress(this.extend({method:o,wallet:h,op_renew:0},t)),l=this.safeValue(d,4,[]),u=this.safeString(l,5),c=void 0===u?this.safeString(l,4):u,f=void 0===u?void 0:this.safeString(l,4);return this.checkAddress(c),{currency:e,address:c,tag:f,network:void 0,info:d}}parseTransactionStatus(e){return this.safeString({SUCCESS:"ok",COMPLETED:"ok",ERROR:"failed",FAILURE:"failed",CANCELED:"canceled","PENDING APPROVAL":"pending",PENDING:"pending","PENDING REVIEW":"pending","PENDING CANCELLATION":"pending",SENDING:"pending","USER APPROVED":"pending"},e,e)}parseTransaction(e,t){let i,s,a,n,o,h,d,l,u,c,f,m,p;let g=e.length;if(8===g){let s=this.safeValue(e,4,[]);i=this.safeInteger(e,0),void 0!==t&&(a=t.code),void 0!==(u=this.safeString(s,8))&&(u=r.Y.stringAbs(u)),n=this.safeNumber(s,5),o=this.safeInteger(s,0),h="ok",0===o&&(o=void 0,h="failed"),d=this.safeString(s,3),l="withdrawal";let c=this.safeString(s,2);m=this.networkIdToCode(c.toUpperCase())}else if(22===g){o=this.safeString(e,0);let d=this.safeString(e,1);a=this.safeCurrencyCode(d,t);let g=this.safeString(e,2);m=this.networkIdToCode(g),i=this.safeInteger(e,5),s=this.safeInteger(e,6),h=this.parseTransactionStatus(this.safeString(e,9));let b=this.safeString(e,12);n=r.Y.stringAbs(b),void 0!==b&&(l=r.Y.stringLt(b,"0")?"withdrawal":"deposit"),void 0!==(u=this.safeString(e,13))&&(u=r.Y.stringAbs(u)),f=this.safeString(e,16),c=this.safeString(e,20),p=this.safeString(e,21)}return{info:e,id:o,txid:c,type:l,currency:a,network:m,amount:this.parseNumber(n),status:h,timestamp:i,datetime:this.iso8601(i),address:f,addressFrom:void 0,addressTo:f,tag:d,tagFrom:void 0,tagTo:d,updated:s,comment:p,internal:void 0,fee:{currency:a,cost:this.parseNumber(u),rate:void 0}}}async fetchTradingFees(e={}){await this.loadMarkets();let t=await this.privatePostAuthRSummary(e),i={},s=this.safeValue(this.options,"fiat",{}),r=this.safeValue(t,4,[]),a=this.safeValue(r,0,[]),n=this.safeValue(r,1,[]),o=this.safeNumber(a,0),h=this.safeNumber(a,2),d=this.safeNumber(a,5),l=this.safeNumber(n,0),u=this.safeNumber(n,2),c=this.safeNumber(n,5);for(let e=0;e<this.symbols.length;e++){let r=this.symbols[e],a=this.market(r),n={info:t,symbol:r,percentage:!0,tierBased:!0};a.quote in s?(n.maker=h,n.taker=u):a.contract?(n.maker=d,n.taker=c):(n.maker=o,n.taker=l),i[r]=n}return i}async fetchDepositsWithdrawals(e,t,i,s={}){let r,a;await this.loadMarkets();let n={};return void 0!==t&&(n.start=t),void 0!==i&&(n.limit=i),void 0!==e?(r=this.currency(e),n.currency=r.uppercaseId,a=await this.privatePostAuthRMovementsCurrencyHist(this.extend(n,s))):a=await this.privatePostAuthRMovementsHist(this.extend(n,s)),this.parseTransactions(a,r,t,i)}async withdraw(e,t,i,r,a={}){this.checkAddress(i),await this.loadMarkets();let n=this.currency(e),o=this.safeString(a,"network",e);a=this.omit(a,"network");let h=this.safeValue(n,"networks",{}),d=this.safeValue(h,o),l=this.safeString(d,"id");if(void 0===l)throw new s.ArgumentsRequired(this.id+" withdraw() could not find a network for '"+e+"'. You can specify it by providing the 'network' value inside params");let u=this.safeString(a,"wallet","exchange");a=this.omit(a,"network","wallet");let c={method:l,wallet:u,amount:this.numberToString(t),address:i};void 0!==r&&(c.payment_id=r);let f=this.safeValue(this.options,"withdraw",{});this.safeBool(f,"includeFee",!1)&&(c.fee_deduct=1);let m=await this.privatePostAuthWWithdraw(this.extend(c,a));if("error"===this.safeString(m,0)){let e=this.id+" "+m,t=this.safeString(m,2,"");throw this.throwExactlyMatchedException(this.exceptions.exact,t,e),this.throwBroadlyMatchedException(this.exceptions.broad,t,e),new s.ExchangeError(e)}let p=this.safeString(m,7);return"success"!==p&&this.throwBroadlyMatchedException(this.exceptions.broad,p,p),this.parseTransaction(m,n)}async fetchPositions(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);let i=await this.privatePostAuthRPositions(t),s=[];for(let e=0;e<i.length;e++)s.push({result:i[e]});return this.parsePositions(s,e)}parsePosition(e,t){let i=this.safeList(e,"result"),s=this.safeString(i,0),a=this.safeString(i,2),n=this.safeInteger(i,12),o=this.safeString(i,19),h=this.safeString(o,"trade_price"),d=this.safeString(o,"trade_amount");return this.safePosition({info:i,id:this.safeString(i,11),symbol:this.safeSymbol(s,t),notional:this.parseNumber(a),marginMode:"isolated",liquidationPrice:this.safeNumber(i,8),entryPrice:this.safeNumber(i,3),unrealizedPnl:this.safeNumber(i,6),percentage:this.safeNumber(i,7),contracts:void 0,contractSize:void 0,markPrice:void 0,lastPrice:void 0,side:r.Y.stringGt(a,"0")?"long":"short",hedged:void 0,timestamp:n,datetime:this.iso8601(n),lastUpdateTimestamp:this.safeInteger(i,13),maintenanceMargin:this.safeNumber(i,18),maintenanceMarginPercentage:void 0,collateral:this.safeNumber(i,17),initialMargin:this.parseNumber(r.Y.stringMul(d,h)),initialMarginPercentage:void 0,leverage:this.safeNumber(i,9),marginRatio:void 0,stopLossPrice:void 0,takeProfitPrice:void 0})}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n="/"+this.implodeParams(e,s),h=this.omit(s,this.extractParams(e));n="v1"===t?t+n:this.version+n;let d=this.urls.api[t]+"/"+n;if("public"===t&&Object.keys(h).length&&(d+="?"+this.urlencode(h)),"private"===t){this.checkRequiredCredentials();let e=this.nonce().toString(),t="/api/"+n+e+(a=this.json(h)),i=this.hmac(this.encode(t),this.encode(this.secret),o.qt);r={"bfx-nonce":e,"bfx-apikey":this.apiKey,"bfx-signature":i,"Content-Type":"application/json"}}return{url:d,method:i,body:a,headers:r}}handleErrors(e,t,i,r,a,n,o,h,d){if(void 0!==o){if(!Array.isArray(o)){let e=this.safeString2(o,"message","error"),t=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,e,t),this.throwBroadlyMatchedException(this.exceptions.broad,e,t),new s.ExchangeError(this.id+" "+n)}}else if(""===o)throw new s.ExchangeError(this.id+" returned empty response");if(429===e)throw new s.RateLimitExceeded(this.id+" "+n);if(500===e){let e=this.safeString(o,1,""),t=this.safeString(o,2,""),i=this.id+" "+t;throw this.throwBroadlyMatchedException(this.exceptions.broad,t,i),this.throwExactlyMatchedException(this.exceptions.exact,e,i),this.throwExactlyMatchedException(this.exceptions.exact,t,i),new s.ExchangeError(this.id+" "+t+" (#"+e+")")}return o}parseLedgerEntryType(e){if(void 0!==e){if(e.indexOf("fee")>=0||e.indexOf("charged")>=0)return"fee";if(e.indexOf("rebate")>=0)return"rebate";if(e.indexOf("deposit")>=0||e.indexOf("withdrawal")>=0)return"transaction";if(e.indexOf("transfer")>=0)return"transfer";else if(e.indexOf("payment")>=0)return"payout";else if(e.indexOf("exchange")>=0||e.indexOf("position")>=0)return"trade";else return e}}parseLedgerEntry(e,t){let i;let s=this.safeList(e,"result",[]),r=this.safeString(s,0),a=this.safeString(s,1),n=this.safeCurrencyCode(a,t);t=this.safeCurrency(a,t);let o=this.safeInteger(s,3),h=this.safeNumber(s,5),d=this.safeNumber(s,6),l=this.safeString(s,8);if(void 0!==l){let e=l.split(" @ "),t=this.safeStringLower(e,0);i=this.parseLedgerEntryType(t)}return this.safeLedgerEntry({info:e,id:r,direction:void 0,account:void 0,referenceId:r,referenceAccount:void 0,type:i,currency:n,amount:h,timestamp:o,datetime:this.iso8601(o),before:void 0,after:d,status:void 0,fee:void 0},t)}async fetchLedger(e,t,i,s={}){let r,a;await this.loadMarkets();let n=!1;if([n,s]=this.handleOptionAndParams(s,"fetchLedger","paginate"),n)return await this.fetchPaginatedCallDynamic("fetchLedger",e,t,i,s,2500);let o={};void 0!==t&&(o.start=t),void 0!==i&&(o.limit=i),[o,s]=this.handleUntilOption("end",o,s),void 0!==e?(r=this.currency(e),o.currency=r.uppercaseId,a=await this.privatePostAuthRLedgersCurrencyHist(this.extend(o,s))):a=await this.privatePostAuthRLedgersHist(this.extend(o,s));let h=[];for(let e=0;e<a.length;e++){let t=a[e];h.push({result:t})}return this.parseLedger(h,r,t,i)}async fetchFundingRates(e,t={}){if(void 0===e)throw new s.ArgumentsRequired(this.id+" fetchFundingRates() requires a symbols argument");await this.loadMarkets();let i={keys:this.marketIds(e).join(",")},r=await this.publicGetStatusDeriv(this.extend(i,t));return this.parseFundingRates(r,e)}async fetchFundingRateHistory(e,t,i,r={}){if(void 0===e)throw new s.ArgumentsRequired(this.id+" fetchFundingRateHistory() requires a symbol argument");await this.loadMarkets();let a=!1;if([a,r]=this.handleOptionAndParams(r,"fetchFundingRateHistory","paginate"),a)return await this.fetchPaginatedCallDeterministic("fetchFundingRateHistory",e,t,i,"8h",r,5e3);let n=this.market(e),o={symbol:n.id};void 0!==t&&(o.start=t),[o,r]=this.handleUntilOption("end",o,r);let h=await this.publicGetStatusDerivSymbolHist(this.extend(o,r)),d=[];for(let e=0;e<h.length;e++){let t=h[e],i=this.parseFundingRateHistory(t,n);d.push(i)}let l=[],u=this.filterBySymbolSinceLimit(d,e,t,i),c=u.length;for(let e=0;e<c;e++){let t=u[c-e-1];l.push(t)}return l}parseFundingRate(e,t){let i=this.safeString(e,0),s=this.safeInteger(e,1),r=this.safeInteger(e,8);return{info:e,symbol:this.safeSymbol(i,t),markPrice:this.safeNumber(e,15),indexPrice:this.safeNumber(e,3),interestRate:void 0,estimatedSettlePrice:void 0,timestamp:s,datetime:this.iso8601(s),fundingRate:this.safeNumber(e,12),fundingTimestamp:void 0,fundingDatetime:void 0,nextFundingRate:this.safeNumber(e,9),nextFundingTimestamp:r,nextFundingDatetime:this.iso8601(r),previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0,interval:void 0}}parseFundingRateHistory(e,t){let i=this.safeInteger(e,0),s=this.safeInteger(e,7);return{info:e,symbol:this.safeSymbol(void 0,t),markPrice:this.safeNumber(e,14),indexPrice:this.safeNumber(e,2),interestRate:void 0,estimatedSettlePrice:void 0,timestamp:i,datetime:this.iso8601(i),fundingRate:this.safeNumber(e,11),fundingTimestamp:void 0,fundingDatetime:void 0,nextFundingRate:this.safeNumber(e,8),nextFundingTimestamp:s,nextFundingDatetime:this.iso8601(s),previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async fetchOpenInterests(e,t={}){await this.loadMarkets();let i=["ALL"];void 0!==(e=this.marketSymbols(e))&&(i=this.marketIds(e));let s={keys:i.join(",")},r=await this.publicGetStatusDeriv(this.extend(s,t));return this.parseOpenInterests(r,e)}async fetchOpenInterest(e,t={}){await this.loadMarkets();let i=this.market(e),s={keys:i.id},r=await this.publicGetStatusDeriv(this.extend(s,t)),a=this.safeList(r,0);return this.parseOpenInterest(a,i)}async fetchOpenInterestHistory(e,t="1m",i,s,r={}){await this.loadMarkets();let a=!1;if([a,r]=this.handleOptionAndParams(r,"fetchOpenInterestHistory","paginate"),a)return await this.fetchPaginatedCallDeterministic("fetchOpenInterestHistory",e,i,s,"8h",r,5e3);let n=this.market(e),o={symbol:n.id};void 0!==i&&(o.start=i),void 0!==s&&(o.limit=s),[o,r]=this.handleUntilOption("end",o,r);let h=await this.publicGetStatusDerivSymbolHist(this.extend(o,r));return this.parseOpenInterestsHistory(h,n,i,s)}parseOpenInterest(e,t){let i=e.length,s=this.safeInteger(e,1),r=this.safeString(e,0);return this.safeOpenInterest({symbol:this.safeSymbol(r,t,void 0,"swap"),openInterestAmount:this.safeNumber(e,23===i?17:18),openInterestValue:void 0,timestamp:s,datetime:this.iso8601(s),info:e},t)}async fetchLiquidations(e,t,i,s={}){await this.loadMarkets();let r=!1;if([r,s]=this.handleOptionAndParams(s,"fetchLiquidations","paginate"),r)return await this.fetchPaginatedCallDeterministic("fetchLiquidations",e,t,i,"8h",s,500);let a=this.market(e),n={};void 0!==t&&(n.start=t),void 0!==i&&(n.limit=i),[n,s]=this.handleUntilOption("end",n,s);let o=await this.publicGetLiquidationsHist(this.extend(n,s));return this.parseLiquidations(o,a,t,i)}parseLiquidation(e,t){let i=e[0],s=this.safeInteger(i,2),a=this.safeString(i,4),n=r.Y.stringAbs(this.safeString(i,5)),o=this.safeString(t,"contractSize"),h=r.Y.stringMul(n,o),d=this.safeString(i,11);return this.safeLiquidation({info:i,symbol:this.safeSymbol(a,t,void 0,"contract"),contracts:this.parseNumber(n),contractSize:this.parseNumber(o),price:this.parseNumber(d),baseValue:this.parseNumber(h),quoteValue:this.parseNumber(r.Y.stringMul(h,d)),timestamp:s,datetime:this.iso8601(s)})}async setMargin(e,t,i={}){await this.loadMarkets();let r=this.market(e);if(!r.swap)throw new s.NotSupported(this.id+" setMargin() only support swap markets");let a={symbol:r.id,collateral:this.parseToNumeric(t)},n=await this.privatePostAuthWDerivCollateralSet(this.extend(a,i)),o=this.safeValue(n,0);return this.parseMarginModification(o,r)}parseMarginModification(e,t){let i=e[0];return{info:e,symbol:t.symbol,type:void 0,marginMode:"isolated",amount:void 0,total:void 0,code:void 0,status:1===i?"ok":"failed",timestamp:void 0,datetime:void 0}}async fetchOrder(e,t,i={}){let s,r;await this.loadMarkets();let a={id:[this.parseToNumeric(e)]};void 0===t?r=await this.privatePostAuthROrders(this.extend(a,i)):(s=this.market(t),a.symbol=s.id,r=await this.privatePostAuthROrdersSymbol(this.extend(a,i)));let n=this.safeList(r,0);return this.parseOrder({result:n},s)}async editOrder(e,t,i,a,n,o,h={}){await this.loadMarkets();let d=this.market(t),l={id:this.parseToNumeric(e)};if(void 0!==n){let e=this.amountToPrecision(t,n);e="buy"===a?e:r.Y.stringNeg(e),l.amount=e}let u=this.safeString2(h,"stopPrice","triggerPrice"),c=this.safeString(h,"trailingAmount"),f=this.safeString(h,"timeInForce"),m=this.safeBool(h,"postOnly",!1),p=this.safeBool(h,"reduceOnly",!1),g=this.safeInteger2(h,"cid","clientOrderId");void 0!==c?l.price_trailing=c:void 0!==u&&(l.price=this.priceToPrecision(t,u),"limit"===i&&(l.price_aux_limit=this.priceToPrecision(t,o))),"market"!==i&&void 0===u&&(l.price=this.priceToPrecision(t,o));let b=0;(m||"PO"===f)&&(b=this.sum(b,4096)),p&&(b=this.sum(b,1024)),0!==b&&(l.flags=b),void 0!==g&&(l.cid=g);let y=this.safeInteger2(h,"leverage","lev");void 0!==y&&(l.lev=y),h=this.omit(h,["triggerPrice","stopPrice","timeInForce","postOnly","reduceOnly","trailingAmount","clientOrderId","leverage"]);let v=await this.privatePostAuthWOrderUpdate(this.extend(l,h));if("SUCCESS"!==this.safeString(v,6)){let e=v[5],t=v[7];throw new s.ExchangeError(this.id+" "+v[6]+": "+t+" (#"+e+")")}let w=this.safeList(v,4,[]);return this.parseOrder({result:w},d)}}}}]);